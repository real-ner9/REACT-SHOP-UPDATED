# React Shop Backend

Backend –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ –Ω–∞ NestJS.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js >= 18.x
- Docker –∏ Docker Compose (–¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)
- npm –∏–ª–∏ yarn

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –° Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) üê≥

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```bash
   npm install
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL —á–µ—Ä–µ–∑ Docker:**
```bash
# –ó–∞–ø—É—Å–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
npm run docker:up

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
docker-compose up -d
```

3. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:**
   ```bash
   cp .env.example .env
```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç Docker:**
```env
# Database (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –¥–ª—è Docker)
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_NAME=react_shop
DATABASE_USER=postgres
DATABASE_PASSWORD=postgres

# JWT (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
JWT_KEY=your-secret-jwt-key-change-in-production
JWT_EXPIRES=24h

# Frontend URL –¥–ª—è CORS
FRONTEND_URL=http://localhost:2001
```

5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
```bash
# Development —Ä–µ–∂–∏–º
npm run start:dev

# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ http://localhost:3000
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ë–µ–∑ Docker (–ª–æ–∫–∞–ª—å–Ω—ã–π PostgreSQL)

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PostgreSQL –ª–æ–∫–∞–ª—å–Ω–æ
2. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:
```bash
createdb react_shop
```
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.env` —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ PostgreSQL
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### Docker –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
npm run docker:up
# –∏–ª–∏
docker compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
npm run docker:down
# –∏–ª–∏
docker compose down

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
npm run docker:logs
# –∏–ª–∏
docker compose logs -f postgres

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
npm run docker:restart

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å volumes (–æ—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ)
docker compose down -v

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `docker compose` (–±–µ–∑ –¥–µ—Ñ–∏—Å–∞) - —Ñ–æ—Ä–º–∞—Ç Docker Compose v2. –ï—Å–ª–∏ —É –≤–∞—Å —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `docker-compose` (—Å –¥–µ—Ñ–∏—Å–æ–º).
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞:
- **Host:** `localhost`
- **Port:** `5432`
- **Database:** `react_shop`
- **User:** `postgres`
- **Password:** `postgres`

–í—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ –ª—é–±–æ–π PostgreSQL –∫–ª–∏–µ–Ω—Ç –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑:
```bash
docker exec -it react-shop-postgres psql -U postgres -d react_shop
```

## üìã –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ

- `DATABASE_HOST` - —Ö–æ—Å—Ç PostgreSQL
- `DATABASE_PORT` - –ø–æ—Ä—Ç PostgreSQL (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5432)
- `DATABASE_NAME` - –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `DATABASE_USER` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `DATABASE_PASSWORD` - –ø–∞—Ä–æ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `JWT_KEY` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤
- `JWT_EXPIRES` - –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ JWT —Ç–æ–∫–µ–Ω–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 24h)

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ

- `NODE_ENV` - –æ–∫—Ä—É–∂–µ–Ω–∏–µ (development/production/test)
- `PORT` - –ø–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 3000)
- `FRONTEND_URL` - URL —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –¥–ª—è CORS (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: http://localhost:2001)
- `DATABASE_SCHEMA` - —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: public)
- `DATABASE_SSL` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSL (true/false)
- `TYPEORM_SYNCHRONIZE` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ö–µ–º—ã (true/false, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: false)
- `TYPEORM_LOGGING` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–æ–≤ (true/false)

### Email (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- `EMAIL_SERVICE` - —Å–µ—Ä–≤–∏—Å email (–Ω–∞–ø—Ä–∏–º–µ—Ä: gmail)
- `EMAIL_HOST` - SMTP —Ö–æ—Å—Ç
- `EMAIL_PORT` - SMTP –ø–æ—Ä—Ç
- `EMAIL_USER` - email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `EMAIL_PASSWORD` - email –ø–∞—Ä–æ–ª—å
- `EMAIL_FROM` - –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è

### Payment - YooKassa (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- `YOOKASSA_SHOP_ID` - ID –º–∞–≥–∞–∑–∏–Ω–∞ YooKassa
- `YOOKASSA_SECRET_KEY` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á YooKassa

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ api/                    # API –º–æ–¥—É–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ auth/               # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ cart/               # –ö–æ—Ä–∑–∏–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ email/              # Email —Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îú‚îÄ‚îÄ email-confirmation/ # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email
‚îÇ   ‚îú‚îÄ‚îÄ favorite/           # –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
‚îÇ   ‚îú‚îÄ‚îÄ feedback/           # –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
‚îÇ   ‚îú‚îÄ‚îÄ files/              # –§–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ orders/             # –ó–∞–∫–∞–∑—ã
‚îÇ   ‚îú‚îÄ‚îÄ payment/            # –ü–ª–∞—Ç–µ–∂–∏
‚îÇ   ‚îú‚îÄ‚îÄ products/           # –¢–æ–≤–∞—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ products-filters/   # –§–∏–ª—å—Ç—Ä—ã —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ slider/             # –°–ª–∞–π–¥–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ user/               # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îú‚îÄ‚îÄ config/                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ configuration.ts    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database.config.ts  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ env.validation.ts   # –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ database/               # –ú–æ–¥—É–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ app.module.ts           # –ö–æ—Ä–Ω–µ–≤–æ–π –º–æ–¥—É–ª—å
‚îî‚îÄ‚îÄ main.ts                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
```

## üîß –ö–æ–º–∞–Ω–¥—ã

   ```bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
   npm run start:dev

# –°–±–æ—Ä–∫–∞
npm run build

# Production
npm run start:prod

# –õ–∏–Ω—Ç–∏–Ω–≥ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
npm run lint
```

## üì° API Endpoints

–í—Å–µ API endpoints –∏–º–µ—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `/api`.

### –ü—Ä–∏–º–µ—Ä—ã:

- `POST /api/auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/auth/login` - –í—Ö–æ–¥
- `GET /api/products` - –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
- `GET /api/cart/:userId` - –ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/orders` - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Joi
- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è DTO —á–µ—Ä–µ–∑ ValidationPipe
- ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- ‚úÖ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–π —á–µ—Ä–µ–∑ TypeORM

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
1. PostgreSQL –∑–∞–ø—É—â–µ–Ω
2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞
3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

### –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É–∫–∞–∑–∞–Ω—ã –≤ `.env` —Ñ–∞–π–ª–µ.

### –ü–æ—Ä—Ç —É–∂–µ –∑–∞–Ω—è—Ç

–ò–∑–º–µ–Ω–∏—Ç–µ `PORT` –≤ `.env` –∏–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –ø–æ—Ä—Ç 3000.

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

Private
